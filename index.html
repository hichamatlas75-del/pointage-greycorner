<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grey Corner â€¢ Gestion Staff</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; margin: 0; overflow-x: hidden; background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%); font-family: 'Plus Jakarta Sans', sans-serif; }
        body::before { content: ""; position: absolute; inset: 0; background-image: url('https://www.transparenttextures.com/patterns/arabesque.png'); opacity: 0.1; pointer-events: none; }
        .card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 32px; width: 100%; max-width: 450px; padding: 25px; margin: 20px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); position: relative; z-index: 10; }
        .btn-staff { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: #f8fafc; transition: all 0.2s; font-size: 11px; text-transform: uppercase; }
        .btn-staff:active { transform: scale(0.95); background: rgba(212, 175, 55, 0.2); }
        .hidden { display: none !important; }
        .team-title { color: #D4AF37; font-size: 10px; font-weight: 800; letter-spacing: 1px; margin-top: 15px; margin-bottom: 8px; border-bottom: 1px solid rgba(212, 175, 55, 0.2); padding-bottom: 2px; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-2">

    <div class="card">
        <div class="text-center mb-5">
            <img src="images/LOGO GREY CORNER.png" alt="Grey Corner" class="h-10 mx-auto mb-4">
            
            <a href="https://grey-corner-app.pages.dev/" style="text-decoration: none;">
                <button type="button" style="background: rgba(39, 174, 96, 0.2); border: 1px solid #27ae60; color: #2ecc71; padding: 6px 14px; border-radius: 10px; font-size: 11px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 6px;">
                    <span>ðŸ“…</span> PLANNING DU <span id="date-btn"></span>
                </button>
            </a>
        </div>

        <div id="statusLabel" class="text-center text-sm font-medium mb-5 text-slate-400">Identification...</div>

        <div id="selectionZone" class="max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar">
            </div>

        <div id="actionZone" class="hidden text-center">
            <button id="submitBtn" onclick="validerPresence()" disabled 
                class="w-full py-4 rounded-2xl bg-gradient-to-r from-amber-500 to-yellow-600 text-slate-900 font-extrabold text-lg shadow-lg active:scale-95 disabled:opacity-30">
                POINTER PRÃ‰SENCE
            </button>
            
            <button onclick="resetUserMemory()" class="mt-8 text-[10px] text-slate-500 underline uppercase tracking-widest block w-full text-center">
                Ce n'est pas moi / Changer de profil
            </button>
        </div>

        <div id="msg" class="text-center mt-4 text-sm min-h-[40px]"></div>

        <div class="flex justify-between items-center mt-6 pt-4 border-t border-slate-700/50">
            <span class="text-[8px] text-slate-500 font-bold tracking-widest uppercase text-left">FÃ¨s â€¢ Grey Corner<br>Ramadan 2026</span>
            <span id="date-footer" class="text-[10px] text-amber-500/80 font-bold"></span>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = { databaseURL: "https://grey-corner-pointage-default-rtdb.europe-west1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const equipeConfig = [
            {n: "BENKHADA ABDESLAM", t: "admin"}, {n: "ENNHAILI SOUMIA", t: "admin"}, {n: "SALIL HOUDA", t: "admin"},
            {n: "CHKAIRI YOUSSEF", t: "bar"}, {n: "ELKOBBI MOSTAFA", t: "bar"}, {n: "FILALI ABDERAFI", t: "bar"}, {n: "KHALOUQ RACHID", t: "bar", ex: true},
            {n: "BELQASSE KHAOULA", t: "cuisine"}, {n: "BOURAHMA ANAS", t: "cuisine"}, {n: "IDRISSI SAAD", t: "cuisine"}, {n: "LEMSSIEH JAWAD", t: "cuisine"}, {n: "MAJDOUB JIHANE", t: "cuisine"}, {n: "MOUJAHID IMANE", t: "cuisine"}, {n: "ZAIR FATIMA", t: "cuisine"},
            {n: "ELGORRAMY ANISSA", t: "menage", ex: true}, {n: "ELGORRAMY SOUAD", t: "menage"}, {n: "ELMCHAOURI SOUAD", t: "menage", ex: true}, {n: "SBAI HAKIMA", t: "menage", ex: true},
            {n: "ALAOUI LAZIZ", t: "service"}, {n: "GUETIBI AMINE", t: "service"}, {n: "HATTAF MOHAMED", t: "service"}, {n: "HIDARA YOUSSEF", t: "service"}, {n: "KAFOUNI ZAKARIAE", t: "service"}, {n: "MOHSINE YOUNESS", t: "service"}
        ];

        let selectedUser = localStorage.getItem('gc_staff_name');

        function getMarocDate() { return new Intl.DateTimeFormat('fr-CA', {timeZone: 'Africa/Casablanca', year: 'numeric', month: '2-digit', day: '2-digit'}).format(new Date()); }
        const dateStr = getMarocDate();
        const [y, m, d] = dateStr.split('-');
        document.getElementById('date-btn').textContent = d + '/' + m;
        document.getElementById('date-footer').textContent = d + '/' + m;

        function checkStatus(name) {
            database.ref('presences/' + dateStr + '/' + name).on('value', snapshot => {
                const statusLabel = document.getElementById('statusLabel');
                const submitBtn = document.getElementById('submitBtn');
                if (snapshot.exists() && snapshot.val().on) {
                    statusLabel.innerHTML = "Bonjour " + name + ", <br><span class='text-green-400 font-bold'>POINTAGE VALIDÃ‰ âœ“</span>";
                    submitBtn.disabled = true;
                } else {
                    statusLabel.innerHTML = "Bonjour <span class='text-white font-bold'>" + name + "</span>,<br>Validez votre prÃ©sence pour le service";
                    submitBtn.disabled = false;
                }
            });
        }

        function init() {
            const selectionZone = document.getElementById('selectionZone');
            const actionZone = document.getElementById('actionZone');

            if (selectedUser) {
                selectionZone.classList.add('hidden');
                actionZone.classList.remove('hidden');
                checkStatus(selectedUser);
            } else {
                selectionZone.classList.remove('hidden');
                actionZone.classList.add('hidden');
                document.getElementById('statusLabel').innerText = "Configurez votre appareil en choisissant votre nom";
                
                // Groupement par Ã©quipe
                const equipes = ["admin", "bar", "cuisine", "menage", "service"];
                equipes.forEach(eq => {
                    const filtered = equipeConfig.filter(emp => emp.t === eq);
                    if(filtered.length > 0) {
                        const title = document.createElement('div');
                        title.className = "team-title uppercase";
                        title.innerText = eq;
                        selectionZone.appendChild(title);
                        
                        const grid = document.createElement('div');
                        grid.className = "grid grid-cols-2 gap-2";
                        
                        filtered.forEach(emp => {
                            const btn = document.createElement('button');
                            btn.className = "btn-staff py-3 px-1 rounded-lg font-bold text-center";
                            btn.innerText = emp.n;
                            btn.onclick = () => {
                                if(confirm("Enregistrer cet appareil pour " + emp.n + " ?")) {
                                    localStorage.setItem('gc_staff_name', emp.n);
                                    selectedUser = emp.n;
                                    init();
                                }
                            };
                            grid.appendChild(btn);
                        });
                        selectionZone.appendChild(grid);
                    }
                });
            }
        }

        async function validerPresence() {
            if (!selectedUser) return;
            document.getElementById('submitBtn').disabled = true;
            
            database.ref('presences/' + dateStr + '/' + selectedUser).update({
                on: true, 
                hA: new Date().toLocaleTimeString('fr-FR', {timeZone: 'Africa/Casablanca'}), 
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById('msg').innerHTML = "Merci " + selectedUser + ". Bon service !";
                document.getElementById('msg').className = "mt-2 p-3 bg-green-500/20 text-green-400 font-bold rounded-lg border border-green-500/30";
            });
        }

        function resetUserMemory() {
            if(confirm("Changer d'utilisateur sur ce tÃ©lÃ©phone ?")) {
                localStorage.removeItem('gc_staff_name');
                location.reload();
            }
        }

        init();
    </script>
</body>
</html>
