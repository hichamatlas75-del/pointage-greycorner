<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Grey Corner â€¢ Master V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;700;800&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; margin: 0; overflow: hidden; background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%); font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(197, 160, 89, 0.3); width: 100%; max-width: 400px; height: 95vh; border-radius: 2.5rem; padding: 1.2rem; display: flex; flex-direction: column; position: relative; box-shadow: 0 0 40px rgba(197, 160, 89, 0.1); }
        .drawer-header { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(197, 160, 89, 0.2); border-radius: 12px; padding: 14px; margin-top: 8px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .drawer-content { display: none; grid-template-columns: repeat(2, 1fr); gap: 8px; padding: 10px 0; }
        .drawer-content.active { display: grid; }
        .btn-staff { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(197, 160, 89, 0.1); height: 45px; font-size: 10px; font-weight: 700; border-radius: 10px; color: #f3e8d2; text-transform: uppercase; }
        .btn-staff:disabled { opacity: 0.15; }
        #successOverlay { display: none; position: absolute; inset: 0; background: #0f172a; z-index: 200; border-radius: 2.5rem; flex-direction: column; align-items: center; justify-content: center; }
        .refresh-spin { animation: spin 0.8s linear; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #c5a059; border-radius: 10px; }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <div class="glass-card">
        <div id="successOverlay"></div>

        <div class="text-center mb-2">
            <img src="images/LOGO GREY CORNER.png" id="logoAdmin" class="h-12 mx-auto mb-2 cursor-pointer transition-transform active:scale-90">
            <a href="https://grey-corner-app.pages.dev/?v=2" target="_blank" class="inline-block">
                <div class="bg-emerald-500/10 border border-emerald-500/50 text-emerald-400 px-4 py-1.5 rounded-xl text-[10px] font-bold inline-flex items-center gap-2">
                    ðŸ“… PLANNING : <span id="date-label"></span>
                </div>
            </a>
        </div>

        <div class="bg-white/5 border border-white/10 rounded-2xl p-3 mb-3 flex items-center justify-between">
            <div class="flex items-center gap-2 text-[10px] font-bold text-slate-300">
                <span id="presentCount" class="text-[#c5a059] text-sm">0</span> MEMBRES EN POSTE
            </div>
            <button onclick="location.reload()" class="text-[#c5a059] p-1">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-1.41 2H4.218a4.485 4.485 0 0 0-3.326 1.508.5.5 0 1 1-.741-.672A5.485 5.485 0 0 1 4.218 8.326h5.906V5.41a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192V9z"/></svg>
            </button>
        </div>

        <div id="statusLabel" class="text-center px-3 py-2 text-[10px] font-bold uppercase mb-4 bg-black/40 border border-white/5 rounded-xl min-h-[50px] flex items-center justify-center text-slate-400">
            CHOISI TON NOM
        </div>

        <div id="selectionZone" class="overflow-y-auto flex-grow custom-scroll hidden"></div>

        <div id="actionZone" class="hidden text-center flex-grow flex flex-col justify-center">
            <button id="submitBtn" onclick="validerPresence()" disabled class="w-full py-12 rounded-[2.5rem] bg-gradient-to-r from-[#c5a059] to-[#8a6d3b] text-slate-900 font-black text-2xl uppercase">
                Pointer ArrivÃ©e
            </button>
            <button onclick="localStorage.clear(); location.reload();" class="mt-10 text-[9px] text-slate-500 underline uppercase">Changer de profil</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // ... (Le reste de votre script firebase et GPS reste le mÃªme que le prÃ©cÃ©dent) ...
        // MAIS : Forcez le rafraÃ®chissement au dÃ©marrage
        window.onload = () => {
            fetchRepos();
            // ChargerTicker();
            
            // Geste Pull to Refresh
            let ts;
            document.addEventListener('touchstart', e => ts = e.touches[0].clientY, {passive: true});
            document.addEventListener('touchend', e => {
                if (e.changedTouches[0].clientY > ts + 150) location.reload();
            }, {passive: true});
        };
    </script>
</body>
</html>
